<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SABBAK ERP | النظام الماسي المتكامل</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af', secondary: '#475569', bgMain: '#f1f5f9',
                        surface: '#ffffff', accent: '#3b82f6', success: '#10b981',    
                        danger: '#ef4444', warning: '#f59e0b', borderC: '#e2e8f0'
                    },
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)'
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; color: #1e293b; font-family: 'Tajawal'; overflow: hidden; height: 100vh; width: 100vw; display: flex; flex-direction: column; }
        
        input, select {
            background-color: #fff !important; border: 1px solid #cbd5e1 !important;
            border-radius: 0.5rem; padding: 0.7rem; width: 100%; outline: none; transition: all 0.2s; font-size: 0.95rem;
        }
        input:focus, select:focus { border-color: #1e40af !important; box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1); }
        
        th { text-align: right; padding: 14px; background: #f8fafc; color: #64748b; font-size: 0.85rem; font-weight: 800; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; z-index: 10; }
        td { padding: 12px 14px; border-bottom: 1px solid #f1f5f9; background: #fff; vertical-align: middle; }
        tr:hover td { background-color: #f1f5f9; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }

        .layout-wrapper { display: flex; height: 100vh; overflow: hidden; }
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100%; background: #f8fafc; }
        .view-container { flex: 1; overflow: hidden; position: relative; display: flex; flex-direction: column; }
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .pos-layout { display: flex; height: 100%; flex-direction: column; overflow: hidden; }
        @media (min-width: 1024px) { .pos-layout { flex-direction: row; } }
        .pos-cart { background: #fff; border-left: 1px solid #e2e8f0; display: flex; flex-direction: column; z-index: 20; box-shadow: -5px 0 25px rgba(0,0,0,0.05); }
        @media (min-width: 1024px) { .pos-cart { width: 420px; height: 100%; } }
        
        .suggestions-list {
            position: absolute; top: 100%; left: 0; right: 0; background: #fff; 
            border: 1px solid #e2e8f0; border-radius: 0.5rem; max-height: 200px; 
            overflow-y: auto; z-index: 50; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        .suggestion-item { padding: 12px; cursor: pointer; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; }
        .suggestion-item:hover { background: #f0f9ff; color: #1e40af; }

        #print-area-wrapper, #report-print-area { position: absolute; left: -9999px; top: -9999px; }
    </style>
</head>
<body>

    <div class="layout-wrapper">
        <aside class="hidden lg:flex w-72 bg-white border-l border-gray-200 flex-col z-30 shadow-soft">
            <div class="p-6 h-24 flex items-center gap-4 border-b border-gray-100 bg-gray-50/50">
                <div class="w-12 h-12 rounded-xl bg-primary flex items-center justify-center text-white text-2xl shadow-lg shadow-blue-900/20"><i class="fa fa-gem"></i></div>
                <div><h1 class="text-2xl font-black text-gray-800 tracking-tight">SABBAK</h1><p class="text-xs text-gray-500 font-bold">ERP System Pro</p></div>
            </div>
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <button onclick="app.nav('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold"><i class="fa fa-chart-pie w-6 text-center text-lg"></i><span>الرئيسية</span></button>
                <button onclick="app.nav('pos')" id="nav-pos" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold"><i class="fa fa-cash-register w-6 text-center text-lg"></i><span>نقطة البيع</span></button>
                <button onclick="app.nav('inventory')" id="nav-inventory" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold"><i class="fa fa-boxes-stacked w-6 text-center text-lg"></i><span>المخزن</span></button>
                <button onclick="app.nav('suppliers')" id="nav-suppliers" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold border border-transparent"><i class="fa fa-truck-fast w-6 text-center text-lg"></i><span>الموردين (الشركات)</span></button>
                <button onclick="app.nav('partners')" id="nav-partners" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold"><i class="fa fa-users w-6 text-center text-lg"></i><span>العملاء</span></button>
                <button onclick="app.nav('finance')" id="nav-finance" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold"><i class="fa fa-wallet w-6 text-center text-lg"></i><span>الخزينة</span></button>
                <button onclick="app.nav('reports')" id="nav-reports" class="nav-btn w-full flex items-center gap-4 p-3.5 rounded-xl text-gray-500 hover:bg-blue-50 hover:text-primary transition-all font-bold"><i class="fa fa-file-contract w-6 text-center text-lg"></i><span>التقارير والجرد</span></button>
            </nav>
            <div class="p-4 mt-auto">
                <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-5 text-white shadow-xl">
                    <p class="text-xs text-gray-400 mb-2 flex justify-between"><span>رصيد الخزينة</span> <i class="fa fa-vault opacity-50"></i></p>
                    <h2 class="text-2xl font-black tracking-wider" id="sidebar-safe">0.00</h2>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shadow-sm z-10">
                <div class="flex items-center gap-4">
                    <button class="lg:hidden text-gray-500"><i class="fa fa-bars text-xl"></i></button>
                    <h2 id="page-title" class="text-xl font-bold text-gray-800">لوحة القيادة</h2>
                </div>
                <div class="flex items-center gap-3">
                    <div class="px-3 py-1 bg-green-50 text-success text-xs font-bold rounded-full border border-green-100 flex items-center gap-2 shadow-sm">
                        <span class="w-2 h-2 bg-success rounded-full animate-pulse"></span> متصل
                    </div>
                </div>
            </header>

            <div class="view-container">
                
                <div id="view-dashboard" class="view-section fade-in h-full overflow-y-auto p-8">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:-translate-y-1 transition"><p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">المبيعات اليومية</p><h3 class="text-3xl font-black text-gray-800" id="dash-sales">0</h3></div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:-translate-y-1 transition"><p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">رأس مال البضاعة</p><h3 class="text-3xl font-black text-primary" id="dash-stock-val">0</h3></div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:-translate-y-1 transition"><p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">لنا (ديون عملاء)</p><h3 class="text-3xl font-black text-success" id="dash-debt-total">0</h3></div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:-translate-y-1 transition bg-red-50/30"><p class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-2">علينا (ديون شركات)</p><h3 class="text-3xl font-black text-danger" id="dash-owe-total">0</h3></div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-white p-6 rounded-2xl border border-gray-100 shadow-card">
                            <h3 class="font-bold text-gray-800 mb-6 text-lg">تحليل المخزون</h3>
                            <div class="h-72"><canvas id="mainChart"></canvas></div>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card flex flex-col">
                            <h3 class="font-bold text-gray-800 mb-6 text-lg">شريط العمليات</h3>
                            <div id="dash-recent-tx" class="flex-1 overflow-y-auto space-y-3 pr-1 custom-scroll"></div>
                        </div>
                    </div>
                </div>

                <div id="view-pos" class="view-section hidden pos-layout fade-in">
                    <div class="flex-1 flex flex-col min-h-0 bg-gray-50/50">
                        <div class="p-4 bg-white border-b border-gray-200 shadow-sm z-10 flex gap-4">
                            <div class="relative flex-1 group">
                                <input id="pos-search" onkeyup="app.filterPos()" type="text" placeholder="بحث باسم المنتج أو الباركود..." class="pl-12 h-12 bg-gray-50 border-gray-200 focus:bg-white shadow-sm rounded-xl transition">
                                <i class="fa fa-search absolute right-4 top-4 text-gray-400 group-focus-within:text-primary transition"></i>
                            </div>
                            <button onclick="app.toggleReturnMode()" id="btn-return" class="px-6 h-12 rounded-xl border border-gray-200 text-gray-500 font-bold text-sm hover:bg-red-50 hover:text-danger hover:border-danger transition flex items-center gap-2"><i class="fa fa-rotate-left"></i> مرتجع</button>
                        </div>
                        <div class="p-4 overflow-y-auto flex-1">
                            <div id="pos-grid" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4 pb-20 lg:pb-0"></div>
                        </div>
                    </div>
                    <div class="pos-cart">
                        <div class="p-5 border-b border-gray-100 flex justify-between items-center bg-white">
                            <h3 class="font-bold text-gray-800 text-lg">سلة البيع</h3>
                            <span class="text-xs bg-blue-50 text-primary px-3 py-1 rounded-lg font-bold" id="cart-count">0</span>
                        </div>
                        <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3 bg-gray-50/50"></div>
                        <div class="p-5 bg-white border-t border-gray-100 space-y-4 shadow-[0_-5px_20px_rgba(0,0,0,0.03)]">
                            <div class="flex justify-between items-center text-2xl font-black text-gray-800"><span>الإجمالي</span><span id="cart-total">0.00</span></div>
                            <div class="relative">
                                <select id="pos-customer" class="bg-gray-50 border-gray-200 text-sm font-bold h-12 px-4 rounded-xl appearance-none"><option value="cash">عميل نقدي (طياري)</option></select>
                                <i class="fa fa-chevron-down absolute left-4 top-4 text-gray-400 pointer-events-none"></i>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <button onclick="app.checkout('cash')" class="bg-success text-white font-bold h-14 rounded-xl shadow-lg shadow-green-100 hover:bg-green-600 transition flex items-center justify-center gap-2 text-lg"><i class="fa fa-money-bill"></i> كاش</button>
                                <button onclick="app.checkout('credit')" class="bg-warning text-white font-bold h-14 rounded-xl shadow-lg shadow-amber-100 hover:bg-amber-500 transition flex items-center justify-center gap-2 text-lg"><i class="fa fa-user-clock"></i> آجل</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="view-inventory" class="view-section hidden h-full overflow-y-auto p-8">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                        <div class="relative w-full md:w-1/2 group">
                            <input id="inv-search" onkeyup="app.filterInv()" type="text" placeholder="بحث شامل في المخزن..." class="pl-12 h-12 shadow-sm rounded-xl border-gray-200">
                            <i class="fa fa-search absolute right-4 top-4 text-gray-400 group-focus-within:text-primary transition"></i>
                        </div>
                        <button onclick="app.toggleModal('modal-product')" class="w-full md:w-auto bg-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-800 transition flex gap-2 items-center justify-center"><i class="fa fa-plus-circle"></i> إضافة / شراء بضاعة</button>
                    </div>
                    <div class="bg-white rounded-2xl border border-gray-200 shadow-card overflow-hidden">
                        <table class="w-full text-right text-sm whitespace-nowrap">
                            <thead><tr><th>الصنف</th><th>المورد</th><th>الكمية</th><th>الشراء</th><th>البيع</th><th>تحكم</th></tr></thead>
                            <tbody id="inv-table"></tbody>
                        </table>
                    </div>
                </div>

                <div id="view-suppliers" class="view-section hidden h-full overflow-y-auto p-8">
                    <div class="flex justify-between items-center mb-8">
                        <div>
                            <h3 class="font-bold text-2xl text-gray-800">الموردين (الشركات)</h3>
                            <p class="text-sm text-gray-500 mt-1">إجمالي الديون المستحقة علينا: <span id="suppliers-total-debt" class="text-danger font-bold bg-red-50 px-2 rounded">0.00</span></p>
                        </div>
                        <button onclick="app.addSupplierPrompt()" class="bg-gray-800 text-white px-6 py-2.5 rounded-xl font-bold shadow-lg hover:bg-black transition"><i class="fa fa-building"></i> إضافة شركة</button>
                    </div>
                    <div id="suppliers-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <div id="view-partners" class="view-section hidden h-full overflow-y-auto p-8">
                    <div class="flex justify-between items-center mb-8">
                        <h3 class="font-bold text-2xl text-gray-800">العملاء (الزبائن)</h3>
                        <button onclick="app.addCustomerPrompt()" class="bg-primary text-white px-6 py-2.5 rounded-xl font-bold shadow-lg hover:bg-blue-800 transition"><i class="fa fa-user-plus"></i> عميل جديد</button>
                    </div>
                    <div id="customers-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <div id="view-finance" class="view-section hidden h-full overflow-y-auto p-8">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="bg-white p-6 rounded-2xl border border-gray-200 h-fit shadow-card sticky top-8">
                            <h3 class="font-bold text-xl mb-6 text-gray-800 border-b border-gray-100 pb-4">تسجيل مصروف إداري</h3>
                            <div class="space-y-4">
                                <div><label class="text-xs font-bold text-gray-500 block mb-1">بند المصروف</label><input id="exp-desc" type="text" placeholder="مثال: فاتورة كهرباء..."></div>
                                <div><label class="text-xs font-bold text-gray-500 block mb-1">المبلغ</label><input id="exp-amount" type="number" placeholder="0.00"></div>
                                <button onclick="app.addExpense()" class="w-full bg-danger text-white py-3.5 rounded-xl font-bold shadow-lg shadow-red-100 hover:bg-red-600 transition">تسجيل خصم</button>
                            </div>
                        </div>
                        <div class="lg:col-span-2 bg-white rounded-2xl border border-gray-200 h-[650px] flex flex-col shadow-card">
                            <div class="p-5 border-b border-gray-100 font-bold bg-gray-50 text-gray-700 flex justify-between items-center">
                                <span>سجل المعاملات المالية</span>
                                <i class="fa fa-money-bill-transfer text-gray-400"></i>
                            </div>
                            <div class="flex-1 overflow-y-auto custom-scroll"><table class="w-full text-right text-sm"><tbody id="finance-table"></tbody></table></div>
                        </div>
                    </div>
                </div>

                <div id="view-reports" class="view-section hidden h-full overflow-y-auto p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-8">التقارير والجرد</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:shadow-lg transition cursor-pointer group" onclick="app.printInventoryReport()">
                            <div class="w-14 h-14 bg-blue-50 text-primary rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="fa fa-print"></i></div>
                            <h3 class="font-bold text-lg mb-2 text-gray-800">تقرير جرد A4</h3>
                            <p class="text-sm text-gray-500">طباعة جرد كامل للمخزن بالأسعار والموردين.</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:shadow-lg transition cursor-pointer group" onclick="app.exportToExcel()">
                            <div class="w-14 h-14 bg-green-50 text-success rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="fa fa-file-excel"></i></div>
                            <h3 class="font-bold text-lg mb-2 text-gray-800">تصدير Excel</h3>
                            <p class="text-sm text-gray-500">تحميل قاعدة البيانات لملف إكسل.</p>
                        </div>
                         <div class="bg-white p-6 rounded-2xl border border-gray-100 shadow-card hover:shadow-lg transition cursor-pointer group" onclick="app.showSupplierSummary()">
                            <div class="w-14 h-14 bg-amber-50 text-warning rounded-2xl flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="fa fa-chart-simple"></i></div>
                            <h3 class="font-bold text-lg mb-2 text-gray-800">ملخص الموردين</h3>
                            <p class="text-sm text-gray-500">إحصائيات التعامل مع الشركات.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <nav class="lg:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around p-2 z-50 h-20 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <button onclick="app.nav('dashboard')" id="mob-dashboard" class="flex flex-col items-center text-gray-400 text-[10px] w-14"><i class="fa fa-chart-pie text-xl mb-1"></i>رئيسية</button>
            <button onclick="app.nav('pos')" id="mob-pos" class="flex flex-col items-center text-gray-400 text-[10px] w-14"><i class="fa fa-cash-register text-xl mb-1"></i>بيع</button>
            <button onclick="app.nav('inventory')" id="mob-inventory" class="flex flex-col items-center text-gray-400 text-[10px] w-14"><i class="fa fa-boxes text-xl mb-1"></i>مخزن</button>
            <button onclick="app.nav('suppliers')" id="mob-suppliers" class="flex flex-col items-center text-gray-400 text-[10px] w-14"><i class="fa fa-truck text-xl mb-1"></i>موردين</button>
            <button onclick="app.nav('finance')" id="mob-finance" class="flex flex-col items-center text-gray-400 text-[10px] w-14"><i class="fa fa-wallet text-xl mb-1"></i>خزينة</button>
        </nav>
    </div>

    <div id="modal-product" class="fixed inset-0 bg-slate-900/60 hidden z-[100] flex items-center justify-center p-4 backdrop-blur-sm fade-in">
        <div class="bg-white w-full max-w-lg rounded-3xl shadow-2xl p-8 relative overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-xl text-gray-800">إضافة / شراء بضاعة</h3>
                <button onclick="app.toggleModal('modal-product')" class="w-9 h-9 rounded-full bg-gray-100 hover:bg-red-50 hover:text-red-500 flex items-center justify-center transition"><i class="fa fa-times"></i></button>
            </div>
            <div class="space-y-5">
                <div class="relative group">
                    <label class="text-xs font-bold text-primary mb-1.5 block">اسم الصنف (بحث تلقائي)</label>
                    <input id="m-name" oninput="app.searchProductForUpdate()" type="text" placeholder="اكتب اسم المنتج..." class="pl-10 h-12 rounded-xl">
                    <i class="fa fa-search absolute right-4 top-9 text-gray-400"></i>
                    <div id="m-suggestions" class="suggestions-list hidden"></div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1.5 block">المورد (الشركة)</label>
                        <div class="relative">
                            <input id="m-supplier" type="text" placeholder="اسم الشركة..." class="h-11">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 mb-1.5 block">طريقة الدفع</label>
                        <select id="m-payment" class="h-11 font-bold">
                            <option value="cash">كاش (خصم من الخزينة)</option>
                            <option value="credit" class="text-red-600">آجل (تسجيل دين علي)</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-2xl border border-gray-100">
                    <div><label class="text-xs font-bold text-gray-600 mb-1 block">سعر الشراء</label><input id="m-buy" type="number" class="h-10"></div>
                    <div><label class="text-xs font-bold text-primary mb-1 block">سعر البيع</label><input id="m-sell" type="number" class="h-10 text-primary font-bold"></div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="text-xs font-bold text-gray-500 mb-1 block">الكمية الواردة</label><input id="m-qty" type="number" placeholder="0" class="h-11"></div>
                    <div><label class="text-xs font-bold text-gray-500 mb-1 block">الباركود</label><input id="m-barcode" type="text" class="h-11"></div>
                </div>

                <button onclick="app.saveProduct()" class="w-full bg-primary text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 hover:bg-blue-800 transition mt-2">حفظ العملية</button>
            </div>
        </div>
    </div>

    <div id="print-area-wrapper">
        <div id="receipt-template" style="width: 78mm; background: #fff; padding: 10px; font-family: 'Tajawal'; font-size: 11px; color: #000;">
            <div style="text-align: center; border-bottom: 2px dashed #000; padding-bottom: 5px; margin-bottom: 5px;">
                <h2 style="margin:0; font-size:16px; font-weight:800;">المهندس</h2>
                <p style="margin:0; font-size:10px;">فاتورة</p>
            </div>
            <div style="font-size:10px; margin-bottom:5px;">
                <div style="display:flex; justify-content:space-between;"><span>تاريخ:</span><span id="r-date"></span></div>
                <div style="display:flex; justify-content:space-between;"><span>فاتورة #:</span><span id="r-id"></span></div>
                <div>عميل: <span id="r-customer"></span></div>
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 10px;">
                <thead style="border-bottom: 1px solid #000;"><tr style="text-align:right"><th>صنف</th><th style="width:20px;text-align:center">ع</th><th>سعر</th></tr></thead>
                <tbody id="r-items"></tbody>
            </table>
            <div style="border-top: 1px solid #000; margin-top: 5px; padding-top: 5px; font-weight: bold; font-size: 14px; display:flex; justify-content:space-between;">
                <span>الإجمالي:</span><span id="r-total"></span>
            </div>
            <div style="text-align: center; margin-top: 5px;"><svg id="r-barcode"></svg></div>
        </div>
    </div>
    
    <div id="report-print-area">
        <div id="report-template" style="width: 210mm; background: #fff; padding: 15mm; font-family: 'Tajawal'; color: #000;">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom: 3px solid #1e40af; padding-bottom: 15px; margin-bottom: 20px;">
                <div><h1 style="margin:0; font-size:26px; color:#1e40af;">تقرير الجرد المخزني</h1><p style="margin:5px 0 0 0; color:#555;">SABBAK ERP System</p></div>
                <div style="text-align:left;"><p><strong>التاريخ:</strong> <span id="rep-date"></span></p></div>
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <thead>
                    <tr style="background-color: #f1f5f9;">
                        <th style="border:1px solid #e2e8f0; padding:10px;">م</th>
                        <th style="border:1px solid #e2e8f0; padding:10px;">الصنف</th>
                        <th style="border:1px solid #e2e8f0; padding:10px;">المورد</th>
                        <th style="border:1px solid #e2e8f0; padding:10px;">الكمية</th>
                        <th style="border:1px solid #e2e8f0; padding:10px;">شراء</th>
                        <th style="border:1px solid #e2e8f0; padding:10px;">بيع</th>
                        <th style="border:1px solid #e2e8f0; padding:10px;">قيمة المخزون</th>
                    </tr>
                </thead>
                <tbody id="rep-items"></tbody>
            </table>
            <div style="margin-top:20px; text-align:left; font-weight:bold;">إجمالي قيمة البضاعة (بسعر الشراء): <span id="rep-total-cost"></span></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, increment, deleteDoc, writeBatch, query, orderBy, limit, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyChNPxcmhJywadU4QhOPs-pgulxvCNr0ec",
            authDomain: "adham-atia.firebaseapp.com",
            projectId: "adham-atia",
            storageBucket: "adham-atia.firebasestorage.app",
            messagingSenderId: "743105915809",
            appId: "1:743105915809:web:af26bab182b60e1870b9e0"
        };

        const appInit = initializeApp(firebaseConfig);
        const db = getFirestore(appInit);
        const state = { products: [], cart: [], customers: [], suppliers: [], isReturn: false };

        window.app = {
            nav: (view) => {
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${view}`).classList.remove('hidden');
                
                const titles = {'dashboard':'لوحة القيادة','pos':'نقطة البيع','inventory':'المخزن','suppliers':'الموردين','partners':'العملاء','finance':'الخزينة','reports':'التقارير'};
                document.getElementById('page-title').innerText = titles[view];
                
                document.querySelectorAll('.nav-btn').forEach(b => { 
                    b.classList.remove('bg-blue-50', 'text-primary'); b.classList.add('text-gray-500'); 
                });
                if(document.getElementById(`nav-${view}`)) document.getElementById(`nav-${view}`).classList.add('bg-blue-50', 'text-primary');

                document.querySelectorAll('[id^="mob-"]').forEach(b => b.classList.remove('text-primary'));
                if(document.getElementById(`mob-${view}`)) document.getElementById(`mob-${view}`).classList.add('text-primary');
            },

            toggleModal: (id) => {
                const el = document.getElementById(id);
                el.classList.toggle('hidden');
                if(!el.classList.contains('hidden') && id==='modal-product') {
                    document.getElementById('m-name').focus();
                    document.getElementById('m-suggestions').innerHTML = '';
                }
            },

            // --- Inventory & Suppliers Logic ---
            searchProductForUpdate: () => {
                const val = document.getElementById('m-name').value.toLowerCase();
                const list = document.getElementById('m-suggestions');
                list.innerHTML = '';
                if(val.length < 2) { list.classList.add('hidden'); return; }
                
                const matches = state.products.filter(p => p.name.toLowerCase().includes(val));
                if(matches.length > 0) {
                    list.classList.remove('hidden');
                    matches.slice(0,5).forEach(p => {
                        const d = document.createElement('div');
                        d.className = 'suggestion-item';
                        d.innerHTML = `<span>${p.name}</span><span class="text-xs text-gray-400">${p.supplier||''}</span>`;
                        d.onclick = () => {
                            document.getElementById('m-name').value = p.name;
                            document.getElementById('m-supplier').value = p.supplier||'';
                            document.getElementById('m-buy').value = p.buy;
                            document.getElementById('m-sell').value = p.sell;
                            document.getElementById('m-barcode').value = p.barcode||'';
                            document.getElementById('m-qty').focus();
                            list.classList.add('hidden');
                        };
                        list.appendChild(d);
                    });
                } else list.classList.add('hidden');
            },

            saveProduct: async () => {
                const name = document.getElementById('m-name').value.trim();
                const supplierName = document.getElementById('m-supplier').value.trim() || "مورد عام";
                const qty = Number(document.getElementById('m-qty').value);
                const buy = Number(document.getElementById('m-buy').value);
                const sell = Number(document.getElementById('m-sell').value);
                const barcode = document.getElementById('m-barcode').value;
                const paymentType = document.getElementById('m-payment').value; // 'cash' or 'credit'

                if(!name || !buy || !sell) return Swal.fire('تنبيه', 'أكمل البيانات', 'warning');

                Swal.showLoading();
                try {
                    const batch = writeBatch(db);
                    
                    // 1. Update/Create Product
                    const q = query(collection(db, "products"), where("name", "==", name));
                    const snap = await getDocs(q);
                    if(!snap.empty) {
                        const docRef = snap.docs[0].ref;
                        batch.update(docRef, { qty: increment(qty), buy, sell, supplier: supplierName, barcode: barcode || snap.docs[0].data().barcode });
                    } else {
                        batch.set(doc(collection(db, "products")), { name, supplier: supplierName, buy, sell, qty, barcode: barcode || Date.now().toString(), min: 5 });
                    }

                    // 2. Handle Financials if qty > 0
                    if(qty > 0) {
                        const totalCost = qty * buy;
                        const txRef = doc(collection(db, "transactions"));
                        
                        if(paymentType === 'cash') {
                            // Deduct from Safe
                            batch.set(txRef, { type: 'purchase_cash', amount: totalCost, details: `شراء كاش: ${name} (${qty}) من ${supplierName}`, date: new Date().toISOString() });
                        } else {
                            // Credit: Find/Create Supplier and add Debt
                            batch.set(txRef, { type: 'purchase_credit', amount: totalCost, details: `شراء آجل: ${name} (${qty}) من ${supplierName}`, date: new Date().toISOString() });
                            
                            // Check if supplier exists to update debt
                            const supQ = query(collection(db, "suppliers"), where("name", "==", supplierName));
                            const supSnap = await getDocs(supQ);
                            if(!supSnap.empty) {
                                batch.update(supSnap.docs[0].ref, { debt: increment(totalCost) });
                            } else {
                                batch.set(doc(collection(db, "suppliers")), { name: supplierName, debt: totalCost });
                            }
                        }
                    }

                    await batch.commit();
                    window.app.toggleModal('modal-product');
                    document.querySelectorAll('#modal-product input').forEach(i => i.value='');
                    Swal.fire({icon:'success', title:'تم الحفظ', toast:true, timer:1500, position:'top'});
                } catch(e) { Swal.fire('خطأ', e.message, 'error'); }
            },
            
            delProduct: async (id) => {
                 if((await Swal.fire({title:'حذف؟', icon:'warning', showCancelButton:true})).isConfirmed) await deleteDoc(doc(db, "products", id));
            },

            // --- Suppliers Management ---
            addSupplierPrompt: async () => {
                const {value: name} = await Swal.fire({input:'text', inputLabel:'اسم الشركة / المورد', showCancelButton:true});
                if(name) await addDoc(collection(db, "suppliers"), {name, debt:0});
            },
            
            paySupplierDebt: async (id) => {
                const {value: amt} = await Swal.fire({input:'number', inputLabel:'المبلغ المدفوع للمورد', showCancelButton:true});
                if(amt) {
                    const b = writeBatch(db);
                    b.update(doc(db, "suppliers", id), {debt: increment(-Number(amt))});
                    b.set(doc(collection(db, "transactions")), {type:'payment_out', amount:Number(amt), date:new Date().toISOString(), details:'سداد دفعة لمورد'});
                    await b.commit();
                    Swal.fire('تم السداد');
                }
            },

            // --- POS Logic ---
            filterPos: () => {
                const q = document.getElementById('pos-search').value.toLowerCase();
                const grid = document.getElementById('pos-grid');
                grid.innerHTML = '';
                state.products.forEach(p => {
                    if(p.name.toLowerCase().includes(q) || (p.barcode && p.barcode.includes(q))) {
                        grid.innerHTML += `
                        <div onclick="app.addToCart('${p.id}')" class="bg-white p-4 rounded-xl border border-gray-100 hover:border-primary cursor-pointer transition shadow-sm h-32 flex flex-col justify-between group">
                            <div class="flex justify-between items-start">
                                <span class="text-[10px] text-gray-500 bg-gray-50 px-2 py-0.5 rounded-lg">${p.supplier}</span>
                                <span class="text-[10px] ${p.qty<=5?'text-danger':'text-success'} font-bold">${p.qty}</span>
                            </div>
                            <h4 class="font-bold text-gray-800 text-sm leading-tight line-clamp-2">${p.name}</h4>
                            <div class="flex justify-between items-end">
                                <span class="text-primary font-bold text-lg">${p.sell}</span>
                                <div class="w-8 h-8 rounded-full bg-gray-50 flex items-center justify-center text-gray-400 group-hover:bg-primary group-hover:text-white transition"><i class="fa fa-plus"></i></div>
                            </div>
                        </div>`;
                    }
                });
            },
            toggleReturnMode: () => {
                state.isReturn = !state.isReturn;
                const btn = document.getElementById('btn-return');
                if(state.isReturn) { btn.classList.add('bg-red-50','text-danger','border-danger'); btn.innerHTML='<i class="fa fa-check"></i> المرتجع مفعل'; }
                else { btn.classList.remove('bg-red-50','text-danger','border-danger'); btn.innerHTML='<i class="fa fa-rotate-left"></i> مرتجع'; }
                state.cart = []; app.renderCart();
            },
            addToCart: (id) => {
                const p = state.products.find(x => x.id === id);
                if(!state.isReturn && p.qty <= 0) return Swal.fire({toast:true, icon:'error', title:'نافذ', position:'top', timer:1000, showConfirmButton:false});
                const ex = state.cart.find(x => x.id === id);
                if(ex) {
                    if(!state.isReturn && ex.qty >= p.qty) return Swal.fire({toast:true, icon:'warning', title:'الكمية', position:'top', timer:1000});
                    ex.qty++;
                } else state.cart.push({...p, qty:1});
                app.renderCart();
            },
            renderCart: () => {
                const div = document.getElementById('cart-items');
                div.innerHTML = ''; let total = 0;
                state.cart.forEach((i, idx) => {
                    total += i.sell * i.qty;
                    div.innerHTML += `
                    <div class="flex justify-between items-center bg-white p-3 rounded-xl border border-gray-100 relative overflow-hidden shadow-sm">
                        ${state.isReturn ? '<div class="absolute inset-y-0 left-0 w-1 bg-danger"></div>' : ''}
                        <div class="flex-1">
                            <div class="font-bold text-sm text-gray-800">${i.name}</div>
                            <div class="text-xs text-gray-500">${i.sell} × ${i.qty}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="app.upQty(${idx}, -1)" class="w-7 h-7 bg-gray-100 rounded-lg text-gray-600 font-bold hover:bg-gray-200">-</button>
                            <span class="text-sm font-bold w-6 text-center">${i.qty}</span>
                            <button onclick="app.upQty(${idx}, 1)" class="w-7 h-7 bg-gray-100 rounded-lg text-gray-600 font-bold hover:bg-gray-200">+</button>
                            <button onclick="app.delCart(${idx})" class="text-danger text-xs px-2"><i class="fa fa-trash"></i></button>
                        </div>
                    </div>`;
                });
                document.getElementById('cart-total').innerText = total.toFixed(2);
                document.getElementById('cart-count').innerText = state.cart.length;
            },
            upQty: (i, v) => {
                const item = state.cart[i];
                const p = state.products.find(x => x.id === item.id);
                if(!state.isReturn && v === 1 && item.qty >= p.qty) return;
                if(v === -1 && item.qty === 1) return app.delCart(i);
                item.qty += v; app.renderCart();
            },
            delCart: (i) => { state.cart.splice(i, 1); app.renderCart(); },

            checkout: async (type) => {
                if(state.cart.length === 0) return Swal.fire('السلة فارغة');
                const cid = document.getElementById('pos-customer').value;
                if(type === 'credit' && cid === 'cash') return Swal.fire('اختر عميل للآجل');
                
                Swal.showLoading();
                const total = Number(document.getElementById('cart-total').innerText);
                const cName = document.getElementById('pos-customer').options[document.getElementById('pos-customer').selectedIndex].text;
                const batch = writeBatch(db);
                const mult = state.isReturn ? -1 : 1;

                state.cart.forEach(i => { batch.update(doc(db, "products", i.id), { qty: increment(-1 * mult * i.qty) }); });
                const ref = doc(collection(db, "invoices"));
                batch.set(ref, { date: new Date().toISOString(), total: total * mult, type, customerId: cid, customerName: cName, items: state.cart, isReturn: state.isReturn });

                const txRef = doc(collection(db, "transactions"));
                if(type === 'cash') {
                    const txType = state.isReturn ? 'expense' : 'sale_cash';
                    batch.set(txRef, { type: txType, amount: total, date: new Date().toISOString(), details: `${state.isReturn?'مرتجع':'بيع'} كاش #${ref.id.substring(0,5)}` });
                } else {
                    batch.set(txRef, { type: 'sale_credit', amount: total * mult, date: new Date().toISOString(), details: `${state.isReturn?'مرتجع':'بيع'} آجل #${ref.id.substring(0,5)}` });
                    batch.update(doc(db, "customers", cid), { debt: increment(total * mult) });
                }

                await batch.commit();
                await app.printReceipt(state.cart, total, ref.id, cName);
                state.cart = []; app.renderCart();
                if(state.isReturn) app.toggleReturnMode();
                Swal.fire({icon:'success', title:'تم', toast:true, timer:1000, position:'top'});
            },

            // --- Reports & Exports ---
            printInventoryReport: () => {
                const date = new Date().toLocaleDateString('ar-EG');
                document.getElementById('rep-date').innerText = date;
                let html = '', totalCost = 0;
                state.products.forEach((p, i) => {
                    const cost = p.qty * p.buy; totalCost += cost;
                    html += `<tr>
                        <td style="border:1px solid #ddd; padding:8px;">${i+1}</td><td style="border:1px solid #ddd; padding:8px;">${p.name}</td>
                        <td style="border:1px solid #ddd; padding:8px;">${p.supplier||'-'}</td><td style="border:1px solid #ddd; padding:8px;">${p.qty}</td>
                        <td style="border:1px solid #ddd; padding:8px;">${p.buy}</td><td style="border:1px solid #ddd; padding:8px;">${p.sell}</td>
                        <td style="border:1px solid #ddd; padding:8px;">${cost.toFixed(2)}</td>
                    </tr>`;
                });
                document.getElementById('rep-items').innerHTML = html;
                document.getElementById('rep-total-cost').innerText = totalCost.toLocaleString();
                html2pdf().from(document.getElementById('report-template')).set({margin:10, filename:`InvReport_${date}.pdf`, html2canvas:{scale:2}, jsPDF:{unit:'mm',format:'a4'}}).save();
            },
            exportToExcel: () => {
                const data = state.products.map(p => ({ "الصنف": p.name, "المورد": p.supplier, "العدد": p.qty, "شراء": p.buy, "بيع": p.sell }));
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(data), "Stock");
                XLSX.writeFile(wb, "Inventory.xlsx");
            },
            showSupplierSummary: () => {
                let html = '<ul class="text-sm space-y-2">';
                state.suppliers.forEach(s => { html += `<li class="flex justify-between border-b pb-1"><span>${s.name}</span><span class="font-bold text-danger">${s.debt} ج.م</span></li>`; });
                html += '</ul>';
                Swal.fire({title: 'مديونيات الموردين', html: html});
            },

            // --- Partners & Finance ---
            addCustomerPrompt: async () => { const {value} = await Swal.fire({input:'text', inputLabel:'اسم العميل', showCancelButton:true}); if(value) await addDoc(collection(db, "customers"), {name:value, debt:0}); },
            payDebt: async (id) => { const {value} = await Swal.fire({input:'number', inputLabel:'دفعة', showCancelButton:true}); if(value) { const b=writeBatch(db); b.update(doc(db,"customers",id),{debt:increment(-Number(value))}); b.set(doc(collection(db,"transactions")),{type:'payment_in',amount:Number(value),date:new Date().toISOString(),details:'سداد عميل'}); await b.commit(); Swal.fire('تم'); } },
            addExpense: async () => { const d=document.getElementById('exp-desc').value, a=document.getElementById('exp-amount').value; if(d&&a) { await addDoc(collection(db,"transactions"),{type:'expense',amount:Number(a),details:d,date:new Date().toISOString()}); document.getElementById('exp-desc').value=''; document.getElementById('exp-amount').value=''; Swal.fire('تم'); } },
            filterInv: () => { const q=document.getElementById('inv-search').value.toLowerCase(); document.querySelectorAll('#inv-table tr').forEach(r=>r.style.display=r.innerText.toLowerCase().includes(q)?'':'none'); },
            printReceipt: (items, total, id, cName) => {
                return new Promise(resolve => {
                    document.getElementById('r-date').innerText = new Date().toLocaleDateString('ar-EG');
                    document.getElementById('r-id').innerText = id.substring(0,6);
                    document.getElementById('r-customer').innerText = cName;
                    document.getElementById('r-total').innerText = total.toFixed(2);
                    document.getElementById('r-items').innerHTML = items.map(i => `<tr><td style="text-align:right">${i.name}</td><td style="text-align:center">${i.qty}</td><td style="text-align:left">${(i.sell*i.qty).toFixed(2)}</td></tr>`).join('');
                    JsBarcode("#r-barcode", id.substring(0,8), {height:25, displayValue:false});
                    html2pdf().from(document.getElementById('receipt-template')).set({margin:0, filename:`Inv_${id.substring(0,5)}.pdf`, image:{type:'jpeg',quality:0.98}, html2canvas:{scale:2}, jsPDF:{unit:'mm',format:[80, 150]}}).save().then(resolve);
                });
            }
        };

        // --- Listeners ---
        onSnapshot(collection(db, "products"), (snap) => {
            state.products = []; let invH = '', stockVal = 0;
            snap.forEach(d => {
                const p = {id:d.id, ...d.data()}; state.products.push(p); stockVal += p.qty * p.buy;
                invH += `<tr class="hover:bg-gray-50 border-b border-gray-100"><td class="font-bold text-gray-700">${p.name}</td><td class="text-xs text-gray-500">${p.supplier||'-'}</td><td class="${p.qty<=5?'text-danger font-bold':'text-success font-bold'} text-center">${p.qty}</td><td class="text-gray-500">${p.buy}</td><td class="text-primary font-bold">${p.sell}</td><td class="text-center"><button onclick="app.delProduct('${p.id}')" class="text-gray-300 hover:text-danger"><i class="fa fa-trash"></i></button></td></tr>`;
            });
            document.getElementById('inv-table').innerHTML = invH;
            document.getElementById('dash-stock-val').innerText = stockVal.toLocaleString();
            app.filterPos();
        });

        onSnapshot(collection(db, "suppliers"), (snap) => {
            state.suppliers = []; let debt = 0, grid = '';
            snap.forEach(d => {
                const s = {id:d.id, ...d.data()}; state.suppliers.push(s); debt += s.debt;
                grid += `<div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm flex justify-between items-center group"><div><h4 class="font-bold text-lg text-gray-800">${s.name}</h4><p class="text-sm text-gray-500">مستحق له: <span class="${s.debt>0?'text-danger font-bold':'text-success'}">${s.debt}</span></p></div>${s.debt>0 ? `<button onclick="app.paySupplierDebt('${s.id}')" class="bg-gray-800 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-black">سداد دفعة</button>` : ''}</div>`;
            });
            document.getElementById('suppliers-grid').innerHTML = grid;
            document.getElementById('suppliers-total-debt').innerText = debt.toFixed(2);
            document.getElementById('dash-owe-total').innerText = debt.toFixed(0);
        });

        onSnapshot(collection(db, "customers"), (snap) => {
            state.customers = []; let debt = 0, grid = '', opts = '<option value="cash">عميل نقدي</option>';
            snap.forEach(d => {
                const c = {id:d.id, ...d.data()}; state.customers.push(c); debt += c.debt; opts += `<option value="${c.id}">${c.name}</option>`;
                grid += `<div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm flex justify-between items-center group"><div><h4 class="font-bold text-lg text-gray-800">${c.name}</h4><p class="text-sm text-gray-500">مديونية: <span class="${c.debt>0?'text-danger font-bold':'text-success'}">${c.debt}</span></p></div>${c.debt>0 ? `<button onclick="app.payDebt('${c.id}')" class="bg-blue-50 text-primary px-4 py-2 rounded-lg text-xs font-bold hover:bg-blue-100">تحصيل</button>` : ''}</div>`;
            });
            document.getElementById('customers-grid').innerHTML = grid; document.getElementById('pos-customer').innerHTML = opts; document.getElementById('dash-debt-total').innerText = debt.toFixed(0);
        });

        onSnapshot(query(collection(db, "transactions"), orderBy("date", "desc"), limit(50)), (snap) => {
            let sales=0, safe=0, html='';
            snap.forEach(d => {
                const t=d.data();
                if(['sale_cash','payment_in'].includes(t.type)) safe += t.amount; 
                else if(['expense','purchase_cash','payment_out'].includes(t.type)) safe -= t.amount;
                if(new Date(t.date).toDateString()===new Date().toDateString() && t.type.includes('sale')) sales += t.amount;
                const c = ['sale_cash','payment_in'].includes(t.type) ? 'text-success' : 'text-danger';
                html += `<tr class="border-b border-gray-50 hover:bg-gray-50"><td class="p-3 text-xs text-gray-400">${new Date(t.date).toLocaleDateString()}</td><td class="text-xs font-bold ${c}">${t.type.split('_')[0]}</td><td class="text-xs text-gray-600">${t.details}</td><td class="font-bold ${c}">${t.amount.toFixed(2)}</td></tr>`;
            });
            document.getElementById('finance-table').innerHTML = html; document.getElementById('dash-sales').innerText = sales.toFixed(0); document.getElementById('sidebar-safe').innerText = safe.toLocaleString();
        });
    </script>
</body>
</html>
